<!DOCTYPE html>
<html>
<head>
	<title>Map</title>
	<link rel="stylesheet" href="leaflet/leaflet.css" />
	<link rel="stylesheet" href="style.css" />
	<script src="leaflet/leaflet-src.js"></script>
	<script src="jQuery/jquery.js"></script>
	<meta charset="utf-8">
</head>
<body>

	
<div id="map"></div>

	<script type="text/javascript">

		buildMap = function(database, marker){
			$.getJSON(database,function(json2){
				if(!json2) return;
				json2.forEach(function(item, index){
					var name = item["name"];
					var gueter = item["gueter"];
					var transport = item["transport"];
					var time = item["time"];
					var streetDisplay = item["streetDisplay"]
					var street = item["street"];
					$.getJSON("http://nominatim.openstreetmap.org/search?street="+street+"&city="+city+"&format=json",function(json){
						if(json.length==0){
							console.log(street);
							return;
						};
						var latitude = json[0]["lat"];
						var longitude = json[0]["lon"];
						if(init){
							map = L.map('map').setView([latitude, longitude], 13);
							OpenStreetMap = L.tileLayer('http://{s}.tile.openstreetmap.se/hydda/full/{z}/{x}/{y}.png', { maxZoom: 25, minZoom: 5, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>' }).addTo(map);
							init = false;
						};
						L.marker([latitude, longitude], {icon: marker})
						.bindPopup("<b>"+name+"</b><br><br>"+streetDisplay+"<br><br>Güter: "+gueter+"<br><br>Transport: "+transport+"<br><br>Öffnungszeiten: "+time)
						.openPopup()
						.addTo(map);
					});
				});
			});
		}

		buildMapL = function(database, marker){
			$.getJSON(database,function(json2){
				if(!json2) return;
				json2.forEach(function(item, index){
					var name = item["name"];
					var days = item["days"];
					var time = item["time"];
					var owner = item["owner"];
					var comment = item["comment"];
					var website = item["website"];
					var email = item["email"];
					var latitude = item["lat"];
					var longitude = item["lon"];
					if(init){
						map = L.map('map').setView([latitude, longitude], 13);
						OpenStreetMap = L.tileLayer('http://{s}.tile.openstreetmap.se/hydda/full/{z}/{x}/{y}.png', { maxZoom: 25, minZoom: 5, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>' }).addTo(map);
						init = false;
					};
					L.marker([latitude, longitude], {icon: marker})
					.bindPopup("<b>"+name+"</b><br><br>Öffnungszeiten: "+time+"<br><br>Tage: "+days+"<br><br>Betreiber: "+owner+"<br><br><a href="+website+">"+website+"</a><br><br>Email: "+email+"<br><br>Bemerkungen: "+comment)
					.openPopup()
					.addTo(map);
				});
			});
		}




		city = "Berlin";
		init = true;
		gotCoords = false;
		map = {};
		OpenStreetMap = {};
		reMap = true;
		floMap = false;

		var marker = L.icon({
			iconUrl:"leaflet/images/marker-icon.png",
			shadowUrl:"leaflet/images/marker-shadow.png"
		});
		var redmarker = L.icon({
			iconUrl:"leaflet/images/red-marker-icon.png",
			shadowUrl:"leaflet/images/marker-shadow.png"
		});

		if(reMap){
			buildMap("ReJson_Parser.php", marker);
		}
		if(floMap){
			buildMapL("FloJson_Parser.php", redmarker);
		}
	</script>

</body>
</html>